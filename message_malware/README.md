# Android SMS/WhatsApp Malware Analysis

## Overview
This (Android malware)[https://github.com/pussycat0x/pegasus_spyware/tree/master/pegasus-spyware-decompiled/sample2/cc9517aafb58279091ac17533293edc1] demonstrates several concerning techniques commonly used to compromise messaging apps, particularly WhatsApp, through excessive permission abuse and file system manipulation.

## Technical Analysis

### Core Attack Vectors

1. **SMS Interception**
   - Registers high-priority (100) SMS receiver in manifest
   - Monitors `android.intent.action.DATA_SMS_RECEIVED`
   - Can potentially intercept SMS verification codes

2. **WhatsApp Database Targeting**
   - Attempts to modify permissions on WhatsApp's private directories:
   ```shell
   chmod 7777 /data/data/com.whatsapp/
   chmod 7777 /data/data/com.whatsapp/databases/
   chmod 777 /data/data/com.whatsapp/databases/msgstore.db
   chmod 7777 /data/data/com.whatsapp/databases/wa.db
   ```
   - Targets critical WhatsApp files:
     - msgstore.db (message history)
     - wa.db (WhatsApp database)
     - com.whatsapp_preferences.xml (app settings)

3. **Permission Abuse**
   - Requests extensive system permissions including:
     - Location access (FINE and COARSE)
     - Camera access
     - Phone state monitoring
     - File system permissions
     - Network access
   - Many requested permissions exceed normal app requirements
   - Used to maintain persistence and gather user data

### Implementation Details

1. **Manifest Configuration**
   - Package: com.binary.sms.receiver
   - Main entry: SkeletonActivity
   - High-priority broadcast receiver for SMS

2. **Runtime Behavior**
   - Uses Runtime.exec() to execute shell commands
   - Modifies system file permissions
   - Monitors app activities and package information
   - Logs sensitive information

## Security Implications

1. **Data Exfiltration Risk**
   - Can potentially access:
     - WhatsApp messages
     - SMS messages
     - Contact information
     - Location data

2. **Privacy Concerns**
   - Extensive permission set allows broad device monitoring
   - Can track user location
   - Access to camera and audio
   - Network activity monitoring

3. **System Integrity**
   - Attempts to modify system file permissions
   - Could compromise Android security model
   - Potential for privilege escalation

## Detection & Prevention

1. **Warning Signs**
   - Excessive permission requests
   - SMS interception capabilities
   - File system modification attempts
   - Access to messaging app data

2. **Security Recommendations**
   - Regular security scans
   - Monitor app permissions
   - Keep Android OS updated
   - Use security-focused Android distributions
   - Implement app-level sandboxing

### Step-by-Step Operation

1. **Initial Setup**
   - Presents as "Binary SMS Receiver" app
   - Requests extensive system permissions during installation
   - Sets up SMS interception receiver with high priority (100)

2. **Main Attack Flow**

    a. SMS Interception

        Monitors for incoming SMS messages
        Can intercept verification codes/messages
    b. WhatsApp Targeting

        Attempts to modify WhatsApp directory permissions
        Targets key files:
        msgstore.db (messages)
        wa.db (WhatsApp database)
        preferences.xml
    c. File Operations

        Uses Runtime.exec() to execute shell commands
        Changes file permissions to 777 (full access)
        Copies and manipulates target files


3. **Persistence**
    - Maintains system access through extensive permissions
    - Uses handler for repeated operations
    - Monitors system state and app activities

4. **Data Collection**
    - Logs information about device
    - Captures SMS data
    - Accesses WhatsApp databases
    - Monitors file system changes

### Implementation Details

1. **Manifest Configuration**
    - Package: com.binary.sms.receiver
    - Main entry: SkeletonActivity
    - High-priority broadcast receiver for SMS

2. **Runtime Behavior**
    - Uses Runtime.exec() to execute shell commands
    - Modifies system file permissions
    - Monitors app activities and package information
    - Logs sensitive information

